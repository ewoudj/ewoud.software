var V=Object.defineProperty;var E=(o,e,t)=>e in o?V(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var n=(o,e,t)=>E(o,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const r of h.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerPolicy&&(h.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?h.credentials="include":s.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(s){if(s.ep)return;s.ep=!0;const h=t(s);fetch(s.href,h)}})();class U{constructor(e){n(this,"offsetLeft",0);n(this,"offsetTop",0);n(this,"scale",1);n(this,"engine");n(this,"context");this.engine=e,this.context=this.engine.canvas.getContext("2d"),window.onresize=this.resize.bind(this),this.resize()}render(){const e=this.engine.canvas;(e.width!==window.innerWidth||e.height!==window.innerHeight)&&this.resize(),this.context.fillStyle=this.engine.canvasColor,this.context.fillRect(0,0,window.innerWidth,window.innerHeight);const t=[];this.engine.entities.forEach(i=>{i.topMost?t.push(i):this.renderEntity(i)}),t.forEach(i=>{this.renderEntity(i)}),this.engine.controller.render(this.context)}resize(){const e=this.engine.canvas;e.style.top="0px",e.style.left="0px",e.width=window.innerWidth,e.height=window.innerHeight;const t=e.width/this.engine.width,i=e.height/this.engine.height;this.scale=t<i?t:i,this.offsetTop=Math.ceil((e.height-this.engine.height*this.scale)/2),this.engine.touchable&&this.offsetTop>40&&(this.offsetTop=40),this.offsetLeft=Math.ceil((this.engine.canvas.width-this.engine.width*this.scale)/2),this.engine.controller.resize()}renderEntity(e){if(e.render(this.context),e.model&&this.drawRects({x:e.position.x,y:e.position.y},e.model,e.color,!0),e.texts)for(const t of e.texts)this.context.font=Math.ceil((t.size||50)*this.scale)+"px "+t.font,this.context.textAlign=t.alignment,this.context.fillStyle=t.color,t.alignment==="center"?this.context.fillText(t.text,Math.ceil(this.engine.width/2*this.scale)+this.offsetLeft,Math.ceil(t.position.y*this.scale)+this.offsetTop):this.context.fillText(t.text,Math.ceil(t.position.x*this.scale)+this.offsetLeft,Math.ceil(t.position.y*this.scale)+this.offsetTop)}drawRects(e,t,i,s){t.forEach(h=>this.drawRect(e,h,i,s))}drawRect(e,t,i,s){s?(this.context.fillStyle=i,this.context.fillRect((t.x+e.x)*this.scale+this.offsetLeft,(t.y+e.y)*this.scale+this.offsetTop,t.w*this.scale,(t.h+2)*this.scale)):(this.context.strokeStyle=i,this.context.strokeRect((t.x+e.x)*this.scale,(t.y+e.y)*this.scale,t.w*this.scale,t.h*this.scale))}}function S(o,e,t){t=t*Math.PI/180;const i=o.x-e.x,s=o.y-e.y,h=Math.atan2(s,i),r=Math.sqrt(i*i+s*s),c=h+t,d=Math.cos(c)*r,a=Math.sin(c)*r;return{x:d*1.4+e.x,y:a+e.y}}function I(o,e){return Math.sqrt(Math.pow(o.x-e.x,2)+Math.pow(o.y-e.y,2))}function Y(o){return{x:Math.ceil(o.x),y:Math.ceil(o.y)}}function O(o,e,t,i){if(o&&e&&t&&i){const s={x:e.x+o.x,y:e.y+o.y},h={x:e.x+e.w+o.x,y:e.y+o.y},r={x:e.x+o.x,y:e.y+e.h+o.y},c={x:e.x+e.w+o.x,y:e.y+e.h+o.y};return w(s,t,i)||w(h,t,i)||w(r,t,i)||w(c,t,i)}return!1}function w(o,e,t){return o.x>=t.x+e.x&&o.x<=t.x+e.x+t.w&&o.y>=t.y+e.y&&o.y<=t.y+e.y+t.h}function H(o){const e=N(o);for(const t of e){t.collisions=[];for(const i of e)t!==i&&A(t,i)&&(t.collisions.push(i),i.collisions||(i.collisions=[]),i.collisions.push(t))}}function N(o){const e=[];for(const t of o)X(t)&&e.push(t);return e}function X(o){return o.position!==void 0&&o.collisions!==void 0&&o.collisionRect!==void 0}function A(o,e){return O(o.position,o.collisionRect,e.position,e.collisionRect)}let P=!1;function L(){if(!P&&(P=!0,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)))try{z.play(),M.play(),k.play(),B.play()}catch{}}const k=v("audio/explosion.mp3"),M=v("audio/appear.mp3"),z=v("audio/changecolor.mp3"),B=v("audio/laser.mp3");function q(o,e,t,i){const s=new XMLHttpRequest;s.open("GET",o,!0),s.responseType="arraybuffer",s.onload=()=>{e.decodeAudioData(s.response,h=>{t(h)},()=>{})},s.send()}function j(o,e){const t=o.createBufferSource();t.buffer=e,t.connect(o.destination),t.start(0)}function v(o){const e={init:()=>{const t=new(window.AudioContext||window.webkitAudioContext);q(e.url,t,i=>{e.play=()=>{j(t,i)}})},play:()=>{},url:o};return e.init(),e}class Z{constructor(e){n(this,"buttonDown",!1);n(this,"menuButtonDown",!1);n(this,"mousePosition",{x:0,y:0});n(this,"absoluteController",!1);let t=[];e.canvas.addEventListener("mousedown",()=>{e.touchable||(this.buttonDown=!0)}),e.canvas.addEventListener("mousemove",i=>{const s=i||window.event,h={x:(s.clientX-e.renderer.offsetLeft)/e.renderer.scale,y:(s.clientY-e.renderer.offsetTop)/e.renderer.scale};e.touchable||(e.canvas===document.pointerLockElement?(this.mousePosition={x:i.movementX,y:i.movementY},this.absoluteController=!1):(this.mousePosition=h,this.absoluteController=!0)),t=[];for(const r of e.entities)r.mousePosition=h,t.push(r)}),e.canvas.addEventListener("mouseup",()=>{e.touchable||(this.buttonDown=!1),t.forEach(i=>i.onMouseUp()),L()})}render(){}resize(){}}class K{constructor(e){n(this,"buttonDown",!1);n(this,"menuButtonDown",!1);n(this,"mousePosition",{x:0,y:0});n(this,"absoluteController",!1);n(this,"engine");n(this,"halfWidth",0);n(this,"leftTouchID",-1);n(this,"rightTouchID",-1);n(this,"secondRightTouchID",-1);n(this,"leftTouchPos",{x:0,y:0});n(this,"leftTouchStartPos",{x:0,y:0});n(this,"leftVector",{x:0,y:0});n(this,"touches");this.engine=e,this.resize(),this.engine.touchable&&(window.addEventListener("touchstart",this.onTouchStart.bind(this),!1),window.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),window.addEventListener("touchend",this.onTouchEnd.bind(this),!1),window.addEventListener("touchcancel",this.onTouchEnd.bind(this),!1))}resize(){this.halfWidth=window.innerWidth/2}render(e){if(this.engine.touchable){const t="rgba(255,255,255,0.18)";let i=!1,s=!1;if(this.touches)for(let h=0,r=this.touches.length;h<r;h++){const c=this.touches[h];c.identifier===this.leftTouchID?(this.drawCircle(e,t,6,this.leftTouchPos,40),this.drawCircle(e,t,2,this.leftTouchStartPos,60),this.drawCircle(e,t,2,this.leftTouchStartPos,40),i=!0):(this.drawCircle(e,t,6,{x:c.clientX,y:c.clientY},50),s=!0)}if(!i){const h={x:70,y:window.innerHeight-70};this.drawCircle(e,t,6,h,40),this.drawCircle(e,t,2,h,60)}s||this.drawCircle(e,t,6,{x:window.innerWidth-70,y:window.innerHeight-70},50),this.drawCircle(e,t,3,{x:window.innerWidth-20,y:40},15),this.drawLine(e,t,3,{x:window.innerWidth-27,y:35},{x:window.innerWidth-13,y:35}),this.drawLine(e,t,3,{x:window.innerWidth-27,y:40},{x:window.innerWidth-13,y:40}),this.drawLine(e,t,3,{x:window.innerWidth-27,y:45},{x:window.innerWidth-13,y:45})}}inMenuArea(e,t){return e>window.innerWidth-45&&t<55}drawLine(e,t,i,s,h){e.beginPath(),e.strokeStyle=t,e.lineWidth=i,e.moveTo(s.x,s.y),e.lineTo(h.x,h.y),e.closePath(),e.stroke()}drawCircle(e,t,i,s,h){e.beginPath(),e.strokeStyle=t,e.lineWidth=i,e.arc(s.x,s.y,h,0,Math.PI*2,!0),e.stroke()}validateTouchId(e,t){let i=-1;for(let s=0;s<t.length;s++)if(t[s].identifier===e){i=e;break}return i}validateTouches(e){this.leftTouchID=this.validateTouchId(this.leftTouchID,e),this.rightTouchID=this.validateTouchId(this.rightTouchID,e),this.secondRightTouchID=this.validateTouchId(this.secondRightTouchID,e)}onTouchStart(e){this.validateTouches(e.touches);for(let t=0,i=e.changedTouches.length;t<i;t++){const s=e.changedTouches[t];this.leftTouchID<0&&s.clientX<this.halfWidth?(this.leftTouchID=s.identifier,this.leftTouchStartPos={x:s.clientX,y:s.clientY},this.leftTouchPos={x:s.clientX,y:s.clientY},this.leftVector={x:0,y:0}):this.inMenuArea(s.clientX,s.clientY)?(this.secondRightTouchID=s.identifier,this.menuButtonDown=!0):this.rightTouchID<0&&(this.rightTouchID=s.identifier,this.buttonDown=!0)}this.touches=e.touches}onTouchMove(e){e.preventDefault();for(let t=0,i=e.changedTouches.length;t<i;t++){const s=e.changedTouches[t];if(this.leftTouchID===s.identifier){this.leftTouchPos={x:s.clientX,y:s.clientY},this.leftVector={x:s.clientX-this.leftTouchStartPos.x,y:s.clientY-this.leftTouchStartPos.y},this.mousePosition={x:Math.floor(this.leftVector.x/5),y:Math.floor(this.leftVector.y/5)},this.absoluteController=!1;break}}this.touches=e.touches}onTouchEnd(e){this.touches=e.touches;for(let t=0,i=e.changedTouches.length;t<i;t++){const s=e.changedTouches[t];this.leftTouchID===s.identifier?(this.leftTouchID=-1,this.leftVector={x:0,y:0},this.mousePosition=this.leftVector,this.absoluteController=!1):this.rightTouchID===s.identifier?(this.rightTouchID=-1,this.buttonDown=!1):this.secondRightTouchID===s.identifier&&this.inMenuArea(s.clientX,s.clientY)&&(this.secondRightTouchID=-1,this.menuButtonDown=!1)}}}class m{constructor(e){n(this,"name","");n(this,"engine");n(this,"finished",!1);n(this,"initialized",!1);n(this,"mousePosition",{x:0,y:0});n(this,"topMost",!1);n(this,"position",{x:0,y:0});n(this,"model",[]);n(this,"color","rgba(0,0,0,0)");n(this,"texts",[]);this.engine=e}render(e){}update(e){}onRemove(){}onMouseUp(){}}class _ extends m{constructor(t,i){super(t);n(this,"alignment","start");n(this,"color","#AAA");n(this,"font","CBM64");n(this,"fontSize",50);n(this,"lineSpacing",10);n(this,"topMost",!0);n(this,"mainMenu",[]);n(this,"selectedColor","#FFF");n(this,"ignoreNextButtonUp",!1);n(this,"selected",null);Object.assign(this,i),this.setItems(this.mainMenu),window.addEventListener("touchend",s=>{for(let h=0;h<s.changedTouches.length;h++){let r=this.getItem((s.changedTouches[h].clientY-t.renderer.offsetTop)/t.renderer.scale);r&&r.onClick&&(L(),r.onClick(this.engine))}})}onMouseUp(){this.ignoreNextButtonUp?this.ignoreNextButtonUp=!1:this.selected&&this.selected.onClick&&this.selected.onClick(this.engine)}setItems(t){this.engine.controller.buttonDown&&(this.ignoreNextButtonUp=!0),this.texts=[];let i=0;for(const s of t){let h=s.text;s.getText&&(h=s.getText()),this.texts.push({alignment:this.alignment,font:this.font,color:this.color,size:this.fontSize,text:h,onClick:s.onClick,position:{x:0,y:this.engine.height/3+i*(this.fontSize+this.lineSpacing)}}),i++}}show(t){this.finished&&(this.finished=!1,this.engine.contains(this)||this.engine.add(this),this.gotoRoot()),t&&this.setItems(t)}toggle(){this.finished?(this.finished=!1,this.engine.contains(this)||this.engine.add(this),this.gotoRoot()):this.finished=!0}hide(){this.finished=!0}update(){this.mousePosition&&this.texts&&this.select(this.getItem(this.mousePosition.y))}getItem(t){let i=null;const s=Math.floor((t-this.engine.height/3)/(this.fontSize+this.lineSpacing))+1;return s>-1&&s<this.texts.length&&this.texts[s].onClick&&(i=this.texts[s]),i}select(t){this.selected!==t&&(this.selected&&(this.selected.color=this.color),this.selected=t,this.selected&&(this.selected.color=this.selectedColor))}gotoRoot(){this.setItems(this.mainMenu)}}class ${constructor(e,t){n(this,"player1Ship");n(this,"player2Ship");n(this,"player3",null);n(this,"player4",null);n(this,"player1Score",0);n(this,"player2Score",0);n(this,"gameOver",!1);this.player1Ship=e,this.player2Ship=t}}const T=[{text:"    SINGLE PLAYER",onClick:o=>{o.logic.startSinglePlayerGame()}},{text:"    MULTI  PLAYER"},{text:""},{text:"    SETTINGS",onClick:o=>{o.logic.menu.setItems(J)}}],J=[{text:"AUDIO",onClick:()=>{},getText:()=>{let o;return o="      AUDIO:  ON",o}},{text:"VIDEO",onClick:()=>{},getText:()=>{let o;return o="      VIDEO:  2D",o}},{text:""},{text:"      MAIN MENU",onClick:o=>{o.logic.menu.setItems(T)}}],Q=[{text:"      GAME OVER"},{text:""},{text:"      PLAY AGAIN",onClick:o=>{o.logic.startSinglePlayerGame()}},{text:"      MAIN MENU",onClick:o=>{o.logic.menu.setItems(T)}}];class F extends m{constructor(t){super(t);n(this,"name","scorebar");n(this,"direction",1);n(this,"finished",!1);n(this,"color","#00F");this.position={x:this.engine.width/2,y:this.engine.height-36},this.model=[{x:-(this.engine.width-30)/2,y:-25,w:this.engine.width-30,h:50}]}setScore(t,i){this.texts.length||(this.texts=[],this.addScoreBarItem("0","#F00",20),this.addScoreBarItem(" 0","#FF0",this.engine.width-95),this.addScoreBarItem("LASER WAR","#FFF",230)),this.texts[0].text=t.toString(),this.texts[1].text=(i<10?" ":"")+i}addScoreBarItem(t,i,s){this.texts.push({alignment:"start",color:i,font:"CBM64",position:{x:s,y:this.engine.height-15},size:50,text:t})}}class y extends m{constructor(t){super(t);n(this,"type","computer");n(this,"direction",0);n(this,"colorIndex",0);n(this,"evadingTime",0);n(this,"targetVector",{x:0,y:0});n(this,"shoot",!1);n(this,"position",{x:0,y:0});n(this,"collisions",[]);n(this,"collisionRect",{x:0,y:0,h:0,w:0})}}class g extends y{constructor(t,i,s,h){super(t);n(this,"owner");n(this,"audioDone",!1);n(this,"startTime",0);n(this,"startPosition",{x:0,y:0});this.owner=s,this.name="laserbeam",this.direction=i,this.color="#FFF",this.position=h,this.model=[{x:-20,y:-5,w:40,h:10}],this.collisionRect=this.model[0],this.audioDone=!1}render(){this.audioDone||(this.audioDone=!0,B.play())}update(t){if(this.finished=this.position.x<-40||this.position.x>this.engine.width+20,this.collisions){for(const i of this.collisions)if(i!==this.owner){this.finished=!0;return}}this.startTime||(this.startTime=t,this.startPosition=this.position),this.position.x=this.startPosition.x+this.direction*(t-this.startTime)/6}}const tt=.3,et=.5;class p extends y{constructor(t,i,s,h,r,c,d,a){super(t);n(this,"starId");n(this,"parent");n(this,"bottomOffset",30);n(this,"angle");n(this,"parentCenter");n(this,"parentOriginalPosition");n(this,"makeSound",!1);this.bottomOffset=i,this.name=h,this.type="star",this.colorIndex=s,this.color=x[s],this.position=r,this.starId=c,this.parent=a,this.angle=d,this.parentCenter={x:this.engine.width/2,y:this.engine.height/2-this.bottomOffset},this.parentOriginalPosition={x:this.engine.width/2,y:this.engine.height*.25-this.bottomOffset},this.collisionRect={x:-15,y:-15,w:30,h:30},this.model=[{x:-10,y:-20,w:20,h:10},{x:-20,y:-10,w:40,h:10},{x:-20,y:0,w:40,h:10},{x:-10,y:10,w:20,h:10}]}render(){this.makeSound&&(z.play(),this.makeSound=!1)}update(t){if(!this.initialized){if(!this.parent)for(let i=0;i<4;i++)this.engine.add(new p(this.engine,this.bottomOffset,this.colorIndex,this.name+"."+i,{x:this.position.x-110,y:this.position.y},this.starId+(i+1),90*i,this));this.initialized=!0}if(this.collisions){for(const i of this.collisions)if(i instanceof g){this.colorIndex++,this.colorIndex===x.length&&(this.colorIndex=0),this.color=x[this.colorIndex],this.makeSound=!0;break}}this.position=this.starId===0||this.starId===5?this.calculateParentPosition(this.starId,t):this.calculateSubPosition(this.starId,t)}calculateParentPosition(t,i){let s=-(tt*(i/40));return t===5&&(s+=180),S(this.parentOriginalPosition,this.parentCenter,s)}calculateSubPosition(t,i){let s=-(et*(i/40));s+=90*(t%5-1);const h=this.calculateParentPosition(t<5?0:5,i),r={x:h.x-100,y:h.y};return S(r,h,s)}}function D(o){const e=o.position;let t=1/0,i=null,s=1/0,h=null,r=null,c=!1;for(const a of o.engine.entities){const l=a instanceof g?a.owner===o:!1;if(a!==o&&!l&&a.position){const u=I(o.position,a.position);u<t&&(t=u,i=a),a instanceof p&&a.colorIndex!==o.colorIndex&&u<s&&(s=u,h=a),a instanceof y&&(a.type==="player"||a.type==="computer")&&(r=a)}}if((o.position&&t<50||o.evadingTime>0)&&i!=null){const a=i.position.x-o.position.x,l=i.position.y-o.position.y;o.targetVector={x:(a<0,1),y:(l<0,1)},o.evadingTime||(o.evadingTime=3),o.evadingTime--,o.mousePosition=S(o.position,i.position,-5),c=!0}let d=null;if(r&&!r.finished&&(d=r),d||(d=h),d){const a=d.position.x-o.position.x,l=d.position.y-o.position.y;if(o.targetVector={x:a<0?-1:1,y:l<0?-1:1},!c){const u=!(l<10&&l>-10),f=!(a<80&&a>-80),W=a<60&&a>-60;o.mousePosition={x:o.position.x+o.targetVector.x*(f?100:W?-100:0),y:o.position.y+o.targetVector.y*(u?100:0)}}o.position.x===e.x&&o.direction!==o.targetVector.x&&(o.direction=o.targetVector.x),o.shoot=l<40&&l>-40&&o.direction===o.targetVector.x}return{mousePosition:o.mousePosition,shoot:o.shoot}}const it={x:-5,y:-5,w:10,h:10};class G extends m{constructor(t,i){super(t);n(this,"duration",0);n(this,"audioDone",!1);this.color="#FFF",this.position=i,this.audioDone=!1}render(){this.renderExplosion(this.duration,!this.audioDone),this.audioDone=!0}update(){this.duration++,this.duration>10&&(this.finished=!0)}renderExplosion(t,i){if(i&&k.play(),t%2){const s={x:0-4*t,y:0};this.model=[];for(let h=0;h<4;h++){const r=S(s,{x:0,y:0},h*90);this.model.push({x:-5+r.x,y:-5+r.y,w:10,h:10})}this.model.push(it)}}}class b extends y{constructor(t,i,s,h,r,c,d){super(t);n(this,"spawnStar");n(this,"collisionRect",{x:-15,y:-10,w:30,h:20});n(this,"shoot",!1);n(this,"laserState");n(this,"invulerability",1e3);n(this,"audioDone",!1);n(this,"gunOffset",{x:40,y:0});n(this,"rectsRight",[{x:-20,y:-15,w:20,h:10},{x:-10,y:-5,w:30,h:10},{x:-20,y:5,w:20,h:10}]);n(this,"rectsLeft",[{x:0,y:-15,w:20,h:10},{x:-20,y:-5,w:30,h:10},{x:0,y:5,w:20,h:10}]);n(this,"lastTimeCalled",0);this.colorIndex=i,this.type=c,this.laserState=300,this.direction=s,this.color=x[i],this.name=h,this.position=r,this.spawnStar=d}update(t){const i=this.getTimeDelta(t);if(this.invulerability&&(this.invulerability-=i,this.invulerability<0&&(this.invulerability=0)),this.collisions)for(const s of this.collisions){const h=s instanceof g?s.owner:null,r=this.invulerability&&s===this.spawnStar;if(h!==this&&!r){s instanceof p&&s.parent&&s.color!==this.color&&(s.finished=!0),this.finished=!0;break}}this.updateControllerState(),this.move(i),this.updateLaser(i)}render(){if(!this.audioDone){this.audioDone=!0;try{M.play()}catch{}}}onRemove(){this.engine.add(new G(this.engine,this.position))}getTimeDelta(t){this.lastTimeCalled||(this.lastTimeCalled=t);const i=t-this.lastTimeCalled;return this.lastTimeCalled=t,i}move(t){const i=this.position;this.position=this.calculateMovement(this.position,this.mousePosition,10,t),this.position.x>i.x?this.direction=1:this.position.x<i.x&&(this.direction=-1),this.model=this.direction===1?this.rectsRight:this.rectsLeft}updateLaser(t){this.shoot&&this.laserState>=300?(this.laserState=0,this.gunOffset.x=this.direction===1?40:-40,this.engine.add(new g(this.engine,this.direction,this,{x:this.position.x+this.gunOffset.x,y:this.position.y+this.gunOffset.y}))):this.laserState<300?this.laserState=this.laserState+t:this.laserState=300}updateControllerState(){if(this.shoot=!1,this.type!=="computer")this.shoot=this.engine.controller.buttonDown,this.mousePosition=this.correctMousePosition(this.engine.controller.mousePosition,this.engine.controller.absoluteController);else if(this.type==="computer"){const t=this.name==="Player 1"?D(this):D(this);this.mousePosition=t.mousePosition,this.shoot=t.shoot}}correctMousePosition(t,i){return i?t:{x:t.x+this.position.x,y:t.y+this.position.y}}calculateMovement(t,i,s,h){const r=i.x-t.x,c=i.y-t.y,d=I(t,i);let a=.25;const l=s*(h/35);d>l&&(a=l/d);let u=this.position.x+r*a,f=this.position.y+c*a;return u<0&&(u=0),u>this.engine.width&&(u=this.engine.width),f<0&&(f=0),f>this.engine.height&&(f=this.engine.height),{x:u,y:f}}}const C=[[{x:-10,y:-15,w:20,h:10},{x:-10,y:-5,w:30,h:10},{x:-10,y:5,w:20,h:10}],[{x:-10,y:-15,w:20,h:10},{x:-20,y:-5,w:10,h:10},{x:0,y:-5,w:20,h:10},{x:-10,y:5,w:20,h:10}],[{x:-10,y:-15,w:20,h:10},{x:-20,y:-5,w:20,h:10},{x:10,y:-5,w:10,h:10},{x:-10,y:5,w:20,h:10}],[{x:-10,y:-15,w:20,h:10},{x:-20,y:-5,w:30,h:10},{x:-10,y:5,w:20,h:10}],[{x:-10,y:-15,w:20,h:10},{x:-20,y:-5,w:40,h:10},{x:-10,y:5,w:20,h:10}]];class R extends y{constructor(t,i,s,h){super(t);n(this,"direction",1);n(this,"collisionRect",{x:-20,y:-15,w:40,h:30});n(this,"shoot",!1);n(this,"laserState",10);n(this,"audioDone",!1);n(this,"invulerability",20);n(this,"gunOffset",{x:40,y:0});n(this,"ufoFrame",0);n(this,"lastTimeCalled",0);n(this,"lastTimeFrameChanged",0);this.colorIndex=i,this.direction=-1,this.name=s,this.type="computer",this.color=x[i],this.position=h}render(){if(!this.audioDone){this.audioDone=!0;try{M.play()}catch{}}}update(t){this.handleCollisions();const i=D(this);this.mousePosition=i.mousePosition,this.shoot=i.shoot;const s=this.getTimeDelta(t);this.position=this.calculateMovement(this.position,this.mousePosition,10,s),this.handleLaser(),this.handleAnimation(t)}onRemove(){this.engine.add(new G(this.engine,this.position))}getTimeDelta(t){this.lastTimeCalled||(this.lastTimeCalled=t);const i=t-this.lastTimeCalled;return this.lastTimeCalled=t,i}calculateMovement(t,i,s,h){let r=t;if(i){const c=i.x-t.x,d=i.y-t.y,a=I(t,i);let l=.25;const u=s*(h/40);a>u&&(l=u/a),r={x:this.position.x+c*l,y:this.position.y+d*l}}return r}handleCollisions(){if(this.invulerability&&this.invulerability--,this.collisions){for(const t of this.collisions)if(!(t instanceof g?t.owner===this:!1)&&!this.invulerability){const s=this.engine.logic.gameState;!s.gameOver&&!this.finished&&t instanceof g&&(t.owner===s.player1Ship&&s.player1Score++,t.owner===s.player2Ship&&s.player2Score++),this.finished=!0;break}}}handleLaser(){this.shoot&&this.laserState===10?(this.laserState=-20,this.gunOffset.x=this.direction===1?40:-40,this.engine.add(new g(this.engine,this.direction,this,{x:this.position.x+this.gunOffset.x,y:this.position.y+this.gunOffset.y}))):this.laserState!==10&&(this.laserState=this.laserState+2)}handleAnimation(t){this.direction=1,this.mousePosition&&this.position.x<this.mousePosition.x&&(this.direction=-1),this.lastTimeFrameChanged||(this.lastTimeFrameChanged=t),t-this.lastTimeFrameChanged>80&&(this.lastTimeFrameChanged=t,this.model=C[this.ufoFrame],this.ufoFrame+=this.direction,this.ufoFrame>=C.length&&(this.ufoFrame=0),this.ufoFrame<0&&(this.ufoFrame=C.length-1)),this.ufoFrame===0?this.direction=1:this.ufoFrame===1?this.direction=1:this.ufoFrame===2?this.direction=1:this.ufoFrame===3?this.direction=-1:this.ufoFrame===4&&(this.direction=-1)}}const x=["#F00","#0F0","#0FF","#FF0","#F0F","#00F","#AAA"];class st extends m{constructor(t){super(t);n(this,"gameState");n(this,"menu");n(this,"playerCount",0);n(this,"barHeight",30);n(this,"previousRightButtonDown",!1);n(this,"previousGameOverState",!1);n(this,"scoreBar");this.menu=new _(this.engine,{engine:this.engine,mainMenu:T}),this.engine.add(this.menu),this.menu.setItems(T),this.scoreBar=new F(this.engine),this.engine.add(this.scoreBar),this.initialized=!1,this.name="rules",this.gameState=this.getDefaultGameState(),t.canvasColor="#000",document.addEventListener("keyup",this.keyboardHandler.bind(this),!1)}update(){if(this.initialized||this.initialize(),this.gameState.gameOver!==this.previousGameOverState)if(this.previousGameOverState=this.gameState.gameOver,this.gameState.gameOver&&this.playerCount>0)this.showGameOver();else if(this.gameState.gameOver&&this.playerCount===0){this.menu.finished?this.engine.reset():this.engine.reset(this.menu);return}else this.hideMenu();this.scoreBar.setScore(this.gameState.player1Score,this.gameState.player2Score),this.previousRightButtonDown!==this.engine.controller.menuButtonDown&&(this.engine.controller.menuButtonDown===!1&&this.toggleMenu(),this.previousRightButtonDown=this.engine.controller.menuButtonDown);const t=10;this.gameState.gameOver=this.gameState.player1Score===t||this.gameState.player2Score===t,this.gameState.player1Ship=this.ensureUserRespawn(this.gameState.player1Ship,this.engine.controller.mousePosition,this.engine.controller.buttonDown,"Player 1",1,0),this.gameState.player2Ship=this.ensureUserRespawn(this.gameState.player2Ship,{x:0,y:0},!1,"Player 2",-1,3),(!this.gameState.player3||this.gameState.player3&&this.gameState.player3.finished)&&Math.floor(Math.random()*200)===6&&this.engine.add(this.gameState.player3=new R(this.engine,2,"Player 3",{x:this.engine.width-40,y:10})),(!this.gameState.player4||this.gameState.player4&&this.gameState.player4.finished)&&Math.floor(Math.random()*200)===6&&this.engine.add(this.gameState.player4=new R(this.engine,4,"Player 4",{x:10,y:this.engine.height-50-this.barHeight}))}startSinglePlayerGame(){this.playerCount=1,this.engine.reset(),this.hideMenu()}keyboardHandler(t){t=t||window.event;const i=t.keyCode||t.which;i===49&&this.startSinglePlayerGame(),i===54&&this.startZeroPlayerGame(),i===77&&this.toggleMenu()}getDefaultGameState(){return new $(new b(this.engine,0,1,"Player 1",{x:10,y:10},this.playerCount===0?"computer":"player"),new b(this.engine,3,-1,"Player 2",{x:this.engine.width-40,y:this.engine.height-50-this.barHeight},this.playerCount!==2?"computer":"player"))}initialize(){this.previousRightButtonDown=!1,this.initialized=!0,this.engine.canvasColor="#000",this.gameState=this.getDefaultGameState(),this.scoreBar=new F(this.engine),this.engine.add(this.scoreBar),this.engine.add(this.gameState.player1Ship),this.engine.add(this.gameState.player2Ship),this.engine.add(new p(this.engine,this.barHeight,0,"Star 1",{x:this.engine.width/2,y:this.engine.height*.25-this.barHeight},0,0)),this.engine.add(new p(this.engine,this.barHeight,3,"Star 2",{x:this.engine.width/2,y:this.engine.height*.75-this.barHeight},5,0))}getStar(t,i,s){for(const h of this.engine.entities)if(h instanceof p&&h.colorIndex===t.colorIndex&&(!i||O(h.position,h.collisionRect,s,{x:-20,y:-20,w:40,h:40})))return h;return null}spawnPlayerShip(t,i,s,h,r,c,d){let a=t;if(t.finished&&(i&&h==="player"||h==="computer")){const l=this.getStar(t,h==="player",d);l&&(a=new b(this.engine,c,r,s,d,h,l),this.engine.add(a))}return a}ensureUserRespawn(t,i,s,h,r,c){let d=t;if(t.finished){let a={x:i.x,y:i.y},l=null;(t.type==="computer"||this.engine.touchable)&&(l=this.getStar(t,!1,i),l&&(a=Y({x:l.position.x,y:l.position.y}))),(t.type==="player"||t.type==="computer"&&l)&&(d=this.spawnPlayerShip(t,s,h,t.type,r,c,a))}return d}startZeroPlayerGame(){this.playerCount=0,this.engine.reset(),this.hideMenu()}showGameOver(){this.showMenu(Q)}showMenu(t){return this.menu.show(t)}toggleMenu(){return this.menu.toggle()}hideMenu(){return this.menu.hide()}}function ot(){if("ontouchstart"in window||window.TouchEvent)return!0;const e=["","-webkit-","-moz-","-o-","-ms-"].map(t=>`(${t}touch-enabled)`);return window.matchMedia(e.join(",")).matches}class nt{constructor(){n(this,"width",800);n(this,"height",600);n(this,"canvasColor","#000");n(this,"logic");n(this,"touchable",ot());n(this,"entities",[]);n(this,"canvas");n(this,"renderer");n(this,"controller");n(this,"pageColor","#000");n(this,"startTime",new Date().getTime());document.onselectstart=()=>!1,document.body.oncontextmenu=()=>!1,document.body.style.background=this.pageColor,this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),this.canvas.style.position="absolute",this.canvas.style.backgroundColor="#000",this.controller=this.touchable?new K(this):new Z(this),this.renderer=new U(this),this.startTime=new Date().getTime(),this.logic=new st(this),this.add(this.logic),this.animate()}add(e){return this.entities.push(e),e.engine=this,e}update(){const e=new Date().getTime()-this.startTime;H(this.entities),this.updateEntities(e)}contains(e){return this.entities.indexOf(e)>-1}reset(e){this.entities=e?[e]:[],this.startTime=new Date().getTime(),this.add(this.logic),this.logic.initialized=!1}updateEntities(e){for(const t of this.entities)t.update(e);this.removeFinishedEntities()}removeFinishedEntities(){const e=this.entities;this.entities=[];for(const t of e)t.finished?t.finished&&t.onRemove():this.entities.push(t)}animate(){requestAnimationFrame(()=>{this.animate()}),this.update(),this.renderer.render()}}new nt;
