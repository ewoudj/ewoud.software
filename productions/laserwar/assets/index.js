var H=Object.defineProperty;var Y=(s,e,t)=>e in s?H(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var o=(s,e,t)=>Y(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const r of h.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerPolicy&&(h.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?h.credentials="include":n.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(n){if(n.ep)return;n.ep=!0;const h=t(n);fetch(n.href,h)}})();const x=new Image;x.src="art.png";x.onload=()=>{z=!0};let z=!1;const k=new Image,C={};k.src="font.png";k.onload=()=>{A=!0};let A=!1;const U=s=>{if(!C[s]){var e=K(s);C[s]=X(k,e[0]/255,e[1]/255,e[2]/255)}return C[s]},X=(s,e,t,i)=>{const n=s.width,h=new OffscreenCanvas(n,n),r=h.getContext("2d");if(r){r.drawImage(s,0,0);const l=r.getImageData(0,0,n,n);for(let c=0;c<l.data.length;c+=4)l.data[c+0]*=e,l.data[c+1]*=t,l.data[c+2]*=i;r.putImageData(l,0,0)}return h};class q{constructor(e){o(this,"offsetLeft",0);o(this,"offsetTop",0);o(this,"scale",1);o(this,"engine");o(this,"context");this.engine=e,this.context=this.engine.canvas.getContext("2d"),window.onresize=this.resize.bind(this),this.resize()}render(){const e=this.engine.canvas;(e.width!==window.innerWidth||e.height!==window.innerHeight)&&this.resize(),this.context.fillStyle=this.engine.canvasColor,this.context.fillRect(0,0,window.innerWidth,window.innerHeight);const t=[];this.engine.entities.forEach(i=>{i.topMost?t.push(i):this.renderEntity(i)}),t.forEach(i=>{this.renderEntity(i)}),this.engine.controller.render(this.context)}resize(){const e=this.engine.canvas;e.style.top="0px",e.style.left="0px",e.width=window.innerWidth,e.height=window.innerHeight;const t=e.width/this.engine.width,i=e.height/this.engine.height;this.scale=t<i?t:i,this.offsetTop=(e.height/this.scale-this.engine.height)/2,this.engine.touchable&&this.offsetTop>40&&(this.offsetTop=40),this.offsetLeft=(this.engine.canvas.width/this.scale-this.engine.width)/2,this.engine.controller.resize()}renderEntity(e){if(e.render(this.context),e.model&&this.drawRects({x:e.position.x,y:e.position.y},e.model,e.color,!0),e.sprites){for(const t of e.sprites)if(z){this.context.save(),this.context.imageSmoothingEnabled=!1;const i=t.width*5/2,n=t.height*5/2;this.context.translate((e.position.x+this.offsetLeft-i)*this.scale,(e.position.y+this.offsetTop-n)*this.scale),this.context.scale(5*this.scale,5*this.scale),t.mirroring===1?(this.context.scale(-1,1),this.context.drawImage(x,t.x,t.y,t.width,t.height,-t.width,0,t.width,t.height)):t.mirroring===2?(this.context.scale(1,-1),this.context.drawImage(x,t.x,t.y,t.width,t.height,0,-t.height,t.width,t.height)):t.mirroring===3?(this.context.scale(-1,-1),this.context.drawImage(x,t.x,t.y,t.width,t.height,-t.width,-t.height,t.width,t.height)):this.context.drawImage(x,t.x,t.y,t.width,t.height,0,0,t.width,t.height),this.context.restore()}}if(e.texts)for(const t of e.texts)this.context.font=Math.ceil((t.size||50)*this.scale)+"px "+t.font,this.context.textAlign=t.alignment,this.context.fillStyle=t.color,t.alignment==="center"?t.font==="SystemFont"?this.renderText(t.text.toLocaleLowerCase(),t.color,t.size/10*this.scale,this.context,[(this.engine.width/2+this.offsetLeft)*this.scale,100]):this.context.fillText(t.text,Math.ceil(this.engine.width/2*this.scale)+this.offsetLeft,Math.ceil(t.position.y*this.scale)+this.offsetTop):t.font==="SystemFont"?this.renderText(t.text.toLocaleLowerCase(),t.color,t.size/10*this.scale,this.context,[(t.position.x+this.offsetLeft)*this.scale,(t.position.y-40+this.offsetTop)*this.scale]):this.context.fillText(t.text,Math.ceil(t.position.x*this.scale)+this.offsetLeft,Math.ceil(t.position.y*this.scale)+this.offsetTop)}renderText(e,t,i,n,h){if(!A)return;const r=U(t);n.save(),n.imageSmoothingEnabled=!1,n.fillStyle=t,n.translate(Math.floor(h[0]),Math.floor(h[1]));for(let l of Array.from(e).map((c,a)=>[a,j[c]]))n.drawImage(r,l[1]*8,0,7,7,l[0]*8*i,0,7*i,7*i);n.restore()}drawRects(e,t,i,n){this.context.save(),n?this.context.fillStyle=i:this.context.strokeStyle=i,this.context.scale(this.scale,this.scale),this.context.translate(e.x+this.offsetLeft,e.y+this.offsetTop),t.forEach(h=>this.drawRect(h,n)),this.context.restore()}drawRect(e,t){t?(this.context.fillRect(e.x,e.y,e.w,e.h),this.context.fillRect(e.x,e.y,e.w,e.h)):this.context.strokeRect(e.x,e.y,e.w,e.h)}}const j={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,">":10,"?":11,a:12,b:13,c:14,d:15,e:16,f:17,g:18,h:19,i:20,j:21,k:22,l:23,m:24,n:25,o:26,p:27,q:28,r:29,s:30,t:31,u:32,v:33,w:34,x:35,y:36,z:37,"-":38,"=":39,".":40," ":41,"/":42,"*":43,"+":44};function K(s){var e=0,t=0,i=0;return s.length===4?(e=parseInt(s.substr(1,1)+s.substr(1,1),16),t=parseInt(s.substr(2,1)+s.substr(2,1),16),i=parseInt(s.substr(3,1)+s.substr(3,1),16)):s.length===7&&(e=parseInt(s.substr(1,2),16),t=parseInt(s.substr(3,2),16),i=parseInt(s.substr(5,2),16)),[e,t,i]}function v(s,e,t){t=t*Math.PI/180;const i=s.x-e.x,n=s.y-e.y,h=Math.atan2(n,i),r=Math.sqrt(i*i+n*n),l=h+t,c=Math.cos(l)*r,a=Math.sin(l)*r;return{x:c*1.4+e.x,y:a+e.y}}function M(s,e){return Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2))}function Z(s){return{x:Math.ceil(s.x),y:Math.ceil(s.y)}}function G(s,e,t,i){if(s&&e&&t&&i){const n={x:e.x+s.x,y:e.y+s.y},h={x:e.x+e.w+s.x,y:e.y+s.y},r={x:e.x+s.x,y:e.y+e.h+s.y},l={x:e.x+e.w+s.x,y:e.y+e.h+s.y};return S(n,t,i)||S(h,t,i)||S(r,t,i)||S(l,t,i)}return!1}function S(s,e,t){return s.x>=t.x+e.x&&s.x<=t.x+e.x+t.w&&s.y>=t.y+e.y&&s.y<=t.y+e.y+t.h}function _(s){const e=$(s);for(const t of e){t.collisions=[];for(const i of e)t!==i&&Q(t,i)&&(t.collisions.push(i),i.collisions||(i.collisions=[]),i.collisions.push(t))}}function $(s){const e=[];for(const t of s)J(t)&&e.push(t);return e}function J(s){return s.position!==void 0&&s.collisions!==void 0&&s.collisionRect!==void 0}function Q(s,e){return G(s.position,s.collisionRect,e.position,e.collisionRect)}class tt{constructor(e){o(this,"buttonDown",!1);o(this,"menuButtonDown",!1);o(this,"mousePosition",{x:0,y:0});o(this,"absoluteController",!1);document.addEventListener("keydown",t=>{e.controller=this,(t.key==="Enter"||t.key===" ")&&(this.buttonDown=!0),t.key==="ArrowUp"||t.key==="w"?this.mousePosition.y=-100:t.key==="ArrowDown"||t.key==="s"?this.mousePosition.y=100:t.key==="ArrowLeft"||t.key==="a"?this.mousePosition.x=-100:(t.key==="ArrowRight"||t.key==="d")&&(this.mousePosition.x=100)}),document.addEventListener("keyup",t=>{(t.key==="Enter"||t.key===" ")&&(this.buttonDown=!1),t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="w"||t.key==="s"?this.mousePosition.y=0:(t.key==="ArrowLeft"||t.key==="ArrowRight"||t.key==="a"||t.key==="d")&&(this.mousePosition.x=0)})}render(e){}resize(){}}class et{constructor(e){o(this,"buttonDown",!1);o(this,"menuButtonDown",!1);o(this,"mousePosition",{x:0,y:0});o(this,"absoluteController",!1);o(this,"engine");o(this,"halfWidth",0);o(this,"leftTouchID",-1);o(this,"rightTouchID",-1);o(this,"secondRightTouchID",-1);o(this,"leftTouchPos",{x:0,y:0});o(this,"leftTouchStartPos",{x:0,y:0});o(this,"leftVector",{x:0,y:0});o(this,"touches");this.engine=e,this.resize(),this.engine.touchable&&(window.addEventListener("touchstart",this.onTouchStart.bind(this),!1),window.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),window.addEventListener("touchend",this.onTouchEnd.bind(this),!1),window.addEventListener("touchcancel",this.onTouchEnd.bind(this),!1))}resize(){this.halfWidth=window.innerWidth/2}render(e){if(this.engine.touchable){const t="rgba(255,255,255,0.18)";let i=!1,n=!1;if(this.touches)for(let h=0,r=this.touches.length;h<r;h++){const l=this.touches[h];l.identifier===this.leftTouchID?(this.drawCircle(e,t,6,this.leftTouchPos,40),this.drawCircle(e,t,2,this.leftTouchStartPos,60),this.drawCircle(e,t,2,this.leftTouchStartPos,40),i=!0):(this.drawCircle(e,t,6,{x:l.clientX,y:l.clientY},50),n=!0)}if(!i){const h={x:70,y:window.innerHeight-70};this.drawCircle(e,t,6,h,40),this.drawCircle(e,t,2,h,60)}n||this.drawCircle(e,t,6,{x:window.innerWidth-70,y:window.innerHeight-70},50),this.drawCircle(e,t,3,{x:window.innerWidth-20,y:40},15),this.drawLine(e,t,3,{x:window.innerWidth-27,y:35},{x:window.innerWidth-13,y:35}),this.drawLine(e,t,3,{x:window.innerWidth-27,y:40},{x:window.innerWidth-13,y:40}),this.drawLine(e,t,3,{x:window.innerWidth-27,y:45},{x:window.innerWidth-13,y:45})}}inMenuArea(e,t){return e>window.innerWidth-45&&t<55}drawLine(e,t,i,n,h){e.beginPath(),e.strokeStyle=t,e.lineWidth=i,e.moveTo(n.x,n.y),e.lineTo(h.x,h.y),e.closePath(),e.stroke()}drawCircle(e,t,i,n,h){e.beginPath(),e.strokeStyle=t,e.lineWidth=i,e.arc(n.x,n.y,h,0,Math.PI*2,!0),e.stroke()}validateTouchId(e,t){let i=-1;for(let n=0;n<t.length;n++)if(t[n].identifier===e){i=e;break}return i}validateTouches(e){this.leftTouchID=this.validateTouchId(this.leftTouchID,e),this.rightTouchID=this.validateTouchId(this.rightTouchID,e),this.secondRightTouchID=this.validateTouchId(this.secondRightTouchID,e)}onTouchStart(e){this.validateTouches(e.touches);for(let t=0,i=e.changedTouches.length;t<i;t++){const n=e.changedTouches[t];this.leftTouchID<0&&n.clientX<this.halfWidth?(this.leftTouchID=n.identifier,this.leftTouchStartPos={x:n.clientX,y:n.clientY},this.leftTouchPos={x:n.clientX,y:n.clientY},this.leftVector={x:0,y:0}):this.inMenuArea(n.clientX,n.clientY)?(this.secondRightTouchID=n.identifier,this.menuButtonDown=!0):this.rightTouchID<0&&(this.rightTouchID=n.identifier,this.buttonDown=!0)}this.touches=e.touches}onTouchMove(e){e.preventDefault();for(let t=0,i=e.changedTouches.length;t<i;t++){const n=e.changedTouches[t];if(this.leftTouchID===n.identifier){this.leftTouchPos={x:n.clientX,y:n.clientY},this.leftVector={x:n.clientX-this.leftTouchStartPos.x,y:n.clientY-this.leftTouchStartPos.y},this.mousePosition={x:Math.floor(this.leftVector.x/5),y:Math.floor(this.leftVector.y/5)},this.absoluteController=!1;break}}this.touches=e.touches}onTouchEnd(e){this.touches=e.touches;for(let t=0,i=e.changedTouches.length;t<i;t++){const n=e.changedTouches[t];this.leftTouchID===n.identifier?(this.leftTouchID=-1,this.leftVector={x:0,y:0},this.mousePosition=this.leftVector,this.absoluteController=!1):this.rightTouchID===n.identifier?(this.rightTouchID=-1,this.buttonDown=!1):this.secondRightTouchID===n.identifier&&this.inMenuArea(n.clientX,n.clientY)&&(this.secondRightTouchID=-1,this.menuButtonDown=!1)}}}var T=(s=>(s[s.none=0]="none",s[s.horizontal=1]="horizontal",s[s.vertical=2]="vertical",s[s.both=3]="both",s))(T||{});class y{constructor(e){o(this,"name","");o(this,"collisionRect",null);o(this,"engine");o(this,"finished",!1);o(this,"initialized",!1);o(this,"mousePosition",{x:0,y:0});o(this,"topMost",!1);o(this,"position",{x:0,y:0});o(this,"model",[]);o(this,"sprites",[]);o(this,"color","rgba(0,0,0,0)");o(this,"texts",[]);this.engine=e}render(e){}update(e){}onRemove(){}onMouseUp(){}}let O=!1;function it(){if(!O&&(O=!0,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)))try{B.play(),L.play(),W.play(),E.play()}catch{}}const W=I("audio/explosion.mp3"),L=I("audio/appear.mp3"),B=I("audio/changecolor.mp3"),E=I("audio/laser.mp3");function st(s,e,t,i){const n=new XMLHttpRequest;n.open("GET",s,!0),n.responseType="arraybuffer",n.onload=()=>{e.decodeAudioData(n.response,h=>{t(h)},()=>{})},n.send()}function nt(s,e){const t=s.createBufferSource();t.buffer=e,t.connect(s.destination),t.start(0)}function I(s){const e={init:()=>{const t=new(window.AudioContext||window.webkitAudioContext);st(e.url,t,i=>{e.play=()=>{nt(t,i)}})},play:()=>{},url:s};return e.init(),e}class ot extends y{constructor(t,i){super(t);o(this,"alignment","start");o(this,"color","#AAA");o(this,"font","SystemFont");o(this,"fontSize",50);o(this,"lineSpacing",10);o(this,"topMost",!0);o(this,"mainMenu",[]);o(this,"selectedColor","#FFF");o(this,"selected",null);Object.assign(this,i),this.setItems(this.mainMenu),window.addEventListener("touchend",n=>{for(let h=0;h<n.changedTouches.length;h++){let r=this.getItem((n.changedTouches[h].clientY-t.renderer.offsetTop)/t.renderer.scale);r&&r.onClick&&(it(),r.onClick(this.engine))}}),window.addEventListener("keyup",n=>{n.key==="Enter"&&this.selected&&this.selected.onClick&&this.selected.onClick(this.engine),n.key==="ArrowUp"&&this.selected?this.selectPreviousItem():n.key==="ArrowDown"&&this.selected?this.selectNextItem():(n.key==="ArrowUp"||n.key==="ArrowDown")&&this.selectDefaultItem()})}setItems(t){this.texts=[];let i=0;for(const h of t){let r=h.text;h.getText&&(r=h.getText());var n={alignment:this.alignment,font:this.font,color:this.color,size:this.fontSize,default:h.default,text:r,onClick:h.onClick,position:{x:0,y:this.engine.height/3+i*(this.fontSize+this.lineSpacing)}};this.texts.push(n),h.default&&this.select(n),i++}}getIndexOfSelectedItem(){return this.selected?this.texts.indexOf(this.selected):-1}selectNextItem(){for(let t=this.getIndexOfSelectedItem()+1;t<this.texts.length;t++)if(this.texts[t].onClick){this.select(this.texts[t]);break}}selectPreviousItem(){for(let t=this.getIndexOfSelectedItem()-1;t>=0;t--)if(this.texts[t].onClick){this.select(this.texts[t]);break}}selectDefaultItem(){for(let t=0;t<this.texts.length;t++)if(this.texts[t].onClick&&this.texts[t].default){this.select(this.texts[t]);break}}show(t){this.finished&&(this.finished=!1,this.engine.contains(this)||this.engine.add(this),this.gotoRoot()),t&&this.setItems(t)}toggle(){this.finished?(this.finished=!1,this.engine.contains(this)||this.engine.add(this),this.gotoRoot()):this.finished=!0}hide(){this.finished=!0}update(){}getItem(t){let i=null;const n=Math.floor((t-this.engine.height/3)/(this.fontSize+this.lineSpacing))+1;return n>-1&&n<this.texts.length&&this.texts[n].onClick&&(i=this.texts[n]),i}select(t){this.selected!==t&&(this.selected&&(this.selected.color=this.color),this.selected=t,this.selected&&(this.selected.color=this.selectedColor))}gotoRoot(){this.setItems(this.mainMenu)}}class ht{constructor(e,t){o(this,"player1Ship");o(this,"player2Ship");o(this,"player3",null);o(this,"player4",null);o(this,"player1Score",0);o(this,"player2Score",0);o(this,"gameOver",!1);this.player1Ship=e,this.player2Ship=t}}const b=[{text:"    SINGLE PLAYER",default:!0,onClick:s=>{s.logic.startSinglePlayerGame()}},{text:"    MULTI  PLAYER"},{text:""},{text:"    SETTINGS",onClick:s=>{s.logic.menu.setItems(rt)}}],rt=[{text:"AUDIO",onClick:()=>{},getText:()=>{let s;return s="      AUDIO:  ON",s}},{text:"VIDEO",onClick:()=>{},getText:()=>{let s;return s="      VIDEO:  2D",s}},{text:""},{text:"      MAIN MENU",default:!0,onClick:s=>{s.logic.menu.setItems(b)}}],at=[{text:"      GAME OVER"},{text:""},{text:"      PLAY AGAIN",default:!0,onClick:s=>{s.logic.startSinglePlayerGame()}},{text:"      MAIN MENU",onClick:s=>{s.logic.menu.setItems(b)}}];class R extends y{constructor(t){super(t);o(this,"name","scorebar");o(this,"direction",1);o(this,"finished",!1);o(this,"color","#69a0f8");this.position={x:this.engine.width/2,y:this.engine.height-38},this.model=[{x:-(this.engine.width-30)/2,y:-25,w:this.engine.width-30,h:50}]}setScore(t,i){this.texts.length||(this.texts=[],this.addScoreBarItem("0","#f84050",40),this.addScoreBarItem(" 0","#d9a859",this.engine.width-115),this.addScoreBarItem("LASER WAR","#FFF",230)),this.texts[0].text=t.toString(),this.texts[1].text=(i<10?" ":"")+i}addScoreBarItem(t,i,n){this.texts.push({alignment:"start",color:i,font:"SystemFont",position:{x:n,y:this.engine.height-15},size:50,text:t})}}class w extends y{constructor(t){super(t);o(this,"type","computer");o(this,"direction",0);o(this,"colorIndex",0);o(this,"evadingTime",0);o(this,"targetVector",{x:0,y:0});o(this,"shoot",!1);o(this,"position",{x:0,y:0});o(this,"collisions",[]);o(this,"collisionRect",{x:0,y:0,h:0,w:0})}}class g extends w{constructor(t,i,n,h){super(t);o(this,"owner");o(this,"audioDone",!1);o(this,"startTime",0);o(this,"startPosition",{x:0,y:0});this.owner=n,this.name="laserbeam",this.direction=i,this.color="#FFF",this.position=h,this.model=[{x:-20,y:-2.5,w:40,h:5}],this.collisionRect=this.model[0],this.audioDone=!1}render(){this.audioDone||(this.audioDone=!0,E.play())}update(t){if(this.finished=this.position.x<-40||this.position.x>this.engine.width+20,this.collisions){for(const i of this.collisions)if(i!==this.owner){this.finished=!0;return}}this.startTime||(this.startTime=t,this.startPosition=this.position),this.position.x=this.startPosition.x+this.direction*(t-this.startTime)/6}}const lt=.3,ct=.5;class p extends w{constructor(t,i,n,h,r,l,c,a){super(t);o(this,"starId");o(this,"parent");o(this,"bottomOffset",30);o(this,"angle");o(this,"parentCenter");o(this,"parentOriginalPosition");o(this,"makeSound",!1);this.bottomOffset=i,this.name=h,this.type="star",this.colorIndex=n,this.color=m[n],this.position=r,this.starId=l,this.parent=a,this.angle=c,this.parentCenter={x:this.engine.width/2,y:this.engine.height/2-this.bottomOffset},this.parentOriginalPosition={x:this.engine.width/2,y:this.engine.height*.25-this.bottomOffset},this.collisionRect={x:-14,y:-12,w:28,h:24},this.model=[],this.sprites=[{x:0,y:28,width:6,height:5,file:"art.png",mirroring:0}]}render(){this.makeSound&&(B.play(),this.makeSound=!1)}update(t){if(!this.initialized){if(!this.parent)for(let i=0;i<4;i++)this.engine.add(new p(this.engine,this.bottomOffset,this.colorIndex,this.name+"."+i,{x:this.position.x-110,y:this.position.y},this.starId+(i+1),90*i,this));this.initialized=!0}if(this.collisions){for(const i of this.collisions)if(i instanceof g){this.colorIndex++,this.colorIndex===m.length&&(this.colorIndex=0),this.color=m[this.colorIndex],this.makeSound=!0;break}this.sprites[0].x=this.colorIndex*7}this.position=this.starId===0||this.starId===5?this.calculateParentPosition(this.starId,t):this.calculateSubPosition(this.starId,t)}calculateParentPosition(t,i){let n=-(lt*(i/40));return t===5&&(n+=180),v(this.parentOriginalPosition,this.parentCenter,n)}calculateSubPosition(t,i){let n=-(ct*(i/40));n+=90*(t%5-1);const h=this.calculateParentPosition(t<5?0:5,i),r={x:h.x-100,y:h.y};return v(r,h,n)}}function P(s){const e=s.position;let t=1/0,i=null,n=1/0,h=null,r=null,l=!1;for(const a of s.engine.entities){const d=a instanceof g?a.owner===s:!1;if(a!==s&&!d&&a.position){const u=M(s.position,a.position);u<t&&(t=u,i=a),a instanceof p&&a.colorIndex!==s.colorIndex&&u<n&&(n=u,h=a),a instanceof w&&(a.type==="player"||a.type==="computer")&&(r=a)}}if((s.position&&t<50||s.evadingTime>0)&&i!=null){const a=i.position.x-s.position.x,d=i.position.y-s.position.y;s.targetVector={x:(a<0,1),y:(d<0,1)},s.evadingTime||(s.evadingTime=3),s.evadingTime--,s.mousePosition=v(s.position,i.position,-5),l=!0}let c=null;if(r&&!r.finished&&(c=r),c||(c=h),c){const a=c.position.x-s.position.x,d=c.position.y-s.position.y;if(s.targetVector={x:a<0?-1:1,y:d<0?-1:1},!l){const u=!(d<10&&d>-10),f=!(a<80&&a>-80),N=a<60&&a>-60;s.mousePosition={x:s.position.x+s.targetVector.x*(f?100:N?-100:0),y:s.position.y+s.targetVector.y*(u?100:0)}}s.position.x===e.x&&s.direction!==s.targetVector.x&&(s.direction=s.targetVector.x),s.shoot=d<40&&d>-40&&s.direction===s.targetVector.x}return{mousePosition:s.mousePosition,shoot:s.shoot}}const dt={x:-2.5,y:-2.5,w:5,h:5};class V extends y{constructor(t,i){super(t);o(this,"duration",0);o(this,"audioDone",!1);this.color="#FFF",this.position=i,this.audioDone=!1}render(){this.renderExplosion(this.duration,!this.audioDone),this.audioDone=!0}update(){this.duration++,this.duration>10&&(this.finished=!0)}renderExplosion(t,i){if(i&&W.play(),t%2){const n={x:0-4*t,y:0};this.model=[];for(let h=0;h<4;h++){const r=v(n,{x:0,y:0},h*90);this.model.push({x:-2.5+r.x,y:-2.5+r.y,w:5,h:5})}this.model.push(dt)}}}class D extends w{constructor(t,i,n,h,r,l,c){super(t);o(this,"spawnStar");o(this,"collisionRect",{x:-18,y:-17,w:36,h:34});o(this,"shoot",!1);o(this,"laserState");o(this,"invulerability",1e3);o(this,"audioDone",!1);o(this,"gunOffset",{x:40,y:0});o(this,"currentFrame",0);o(this,"timeNextFrame",0);o(this,"frameCount",7);o(this,"sprite",{x:0,y:0,width:8,height:7,file:"art.png",mirroring:T.none});o(this,"lastTimeCalled",0);this.colorIndex=i,this.type=l,this.laserState=300,this.direction=n,this.color=m[i],this.name=h,this.position=r,this.spawnStar=c,this.sprite.y=i===0?0:8,this.sprites=[this.sprite]}update(t){const i=this.getTimeDelta(t);if(this.timeNextFrame-=i,this.timeNextFrame<0&&(this.timeNextFrame=150,this.currentFrame=(this.currentFrame+1)%this.frameCount,this.sprite.x=this.currentFrame*9),this.invulerability&&(this.invulerability-=i,this.invulerability<0&&(this.invulerability=0)),this.collisions)for(const n of this.collisions){const h=n instanceof g?n.owner:null,r=this.invulerability&&n===this.spawnStar;if(h!==this&&!r){n instanceof p&&n.parent&&n.color!==this.color&&(n.finished=!0),this.finished=!0;break}}this.updateControllerState(),this.move(i),this.updateLaser(i)}render(){if(!this.audioDone){this.audioDone=!0;try{L.play()}catch{}}}onRemove(){this.engine.add(new V(this.engine,this.position))}getTimeDelta(t){this.lastTimeCalled||(this.lastTimeCalled=t);const i=t-this.lastTimeCalled;return this.lastTimeCalled=t,i}move(t){const i=this.position;this.position=this.calculateMovement(this.position,this.mousePosition,6,t),this.position.x>i.x?this.direction=1:this.position.x<i.x&&(this.direction=-1),this.sprite.mirroring=this.direction===1?T.none:T.horizontal}updateLaser(t){this.shoot&&this.laserState>=300?(this.laserState=0,this.gunOffset.x=this.direction===1?40:-40,this.engine.add(new g(this.engine,this.direction,this,{x:this.position.x+this.gunOffset.x,y:this.position.y+this.gunOffset.y}))):this.laserState<300?this.laserState=this.laserState+t:this.laserState=300}updateControllerState(){if(this.shoot=!1,this.type!=="computer")this.shoot=this.engine.controller.buttonDown,this.mousePosition=this.correctMousePosition(this.engine.controller.mousePosition,this.engine.controller.absoluteController);else if(this.type==="computer"){const t=this.name==="Player 1"?P(this):P(this);this.mousePosition=t.mousePosition,this.shoot=t.shoot}}correctMousePosition(t,i){return i?t:{x:t.x+this.position.x,y:t.y+this.position.y}}calculateMovement(t,i,n,h){const r=i.x-t.x,l=i.y-t.y,c=M(t,i);let a=.25;const d=n*(h/35);c>d&&(a=d/c);let u=this.position.x+r*a,f=this.position.y+l*a;return u<0&&(u=0),u>this.engine.width&&(u=this.engine.width),f<0&&(f=0),f>this.engine.height&&(f=this.engine.height),{x:u,y:f}}}class F extends w{constructor(t,i,n,h){super(t);o(this,"direction",1);o(this,"collisionRect",{x:-19,y:-12,w:38,h:24});o(this,"shoot",!1);o(this,"laserState",10);o(this,"audioDone",!1);o(this,"invulerability",20);o(this,"gunOffset",{x:60,y:0});o(this,"ufoFrame",0);o(this,"lastTimeCalled",0);o(this,"lastTimeFrameChanged",0);o(this,"sprite",{x:0,y:16,width:8,height:5,file:"art.png",mirroring:0});o(this,"sprites",[this.sprite]);this.colorIndex=i,i===4&&(this.sprite.y=22),this.direction=-1,this.name=n,this.type="computer",this.color=m[i],this.position=h}render(){if(!this.audioDone){this.audioDone=!0;try{L.play()}catch{}}}update(t){this.handleCollisions();const i=P(this);this.mousePosition=i.mousePosition,this.shoot=i.shoot;const n=this.getTimeDelta(t);this.position=this.calculateMovement(this.position,this.mousePosition,6,n),this.handleLaser(),this.handleAnimation(t)}onRemove(){this.engine.add(new V(this.engine,this.position))}getTimeDelta(t){this.lastTimeCalled||(this.lastTimeCalled=t);const i=t-this.lastTimeCalled;return this.lastTimeCalled=t,i}calculateMovement(t,i,n,h){let r=t;if(i){const l=i.x-t.x,c=i.y-t.y,a=M(t,i);let d=.25;const u=n*(h/40);a>u&&(d=u/a),r={x:this.position.x+l*d,y:this.position.y+c*d}}return r}handleCollisions(){if(this.invulerability&&this.invulerability--,this.collisions){for(const t of this.collisions)if(!(t instanceof g?t.owner===this:!1)&&!this.invulerability){const n=this.engine.logic.gameState;!n.gameOver&&!this.finished&&t instanceof g&&(t.owner===n.player1Ship&&n.player1Score++,t.owner===n.player2Ship&&n.player2Score++),this.finished=!0;break}}}handleLaser(){this.shoot&&this.laserState===10?(this.laserState=-20,this.gunOffset.x=this.direction===1?40:-40,this.engine.add(new g(this.engine,this.direction,this,{x:this.position.x+this.gunOffset.x,y:this.position.y+this.gunOffset.y}))):this.laserState!==10&&(this.laserState=this.laserState+2)}handleAnimation(t){this.direction=1,this.mousePosition&&this.position.x<this.mousePosition.x&&(this.direction=-1),this.lastTimeFrameChanged||(this.lastTimeFrameChanged=t),t-this.lastTimeFrameChanged>80&&(this.lastTimeFrameChanged=t,this.ufoFrame+=this.direction,this.ufoFrame>=8&&(this.ufoFrame=0),this.ufoFrame<0&&(this.ufoFrame=7)),this.sprite.x=this.ufoFrame*9,this.ufoFrame===0?this.direction=1:this.ufoFrame===1?this.direction=1:this.ufoFrame===2?this.direction=1:this.ufoFrame===3?this.direction=-1:this.ufoFrame===4&&(this.direction=-1)}}const m=["#f84050","#38f078","#d9a859","#69a0f8","#ff91fb","#2ff9f8","#f8f8f8","#586968"];class ut extends y{constructor(t){super(t);o(this,"gameState");o(this,"menu");o(this,"playerCount",0);o(this,"barHeight",30);o(this,"previousRightButtonDown",!1);o(this,"previousGameOverState",!1);o(this,"scoreBar");this.menu=new ot(this.engine,{engine:this.engine,mainMenu:b}),this.engine.add(this.menu),this.menu.setItems(b),this.scoreBar=new R(this.engine),this.engine.add(this.scoreBar),this.initialized=!1,this.name="rules",this.gameState=this.getDefaultGameState(),t.canvasColor="#000",document.addEventListener("keyup",this.keyboardHandler.bind(this),!1)}update(){if(this.initialized||this.initialize(),this.gameState.gameOver!==this.previousGameOverState)if(this.previousGameOverState=this.gameState.gameOver,this.gameState.gameOver&&this.playerCount>0)this.showGameOver();else if(this.gameState.gameOver&&this.playerCount===0){this.menu.finished?this.engine.reset():this.engine.reset(this.menu);return}else this.hideMenu();this.scoreBar.setScore(this.gameState.player1Score,this.gameState.player2Score),this.previousRightButtonDown!==this.engine.controller.menuButtonDown&&(this.engine.controller.menuButtonDown===!1&&this.toggleMenu(),this.previousRightButtonDown=this.engine.controller.menuButtonDown);const t=10;this.gameState.gameOver=this.gameState.player1Score===t||this.gameState.player2Score===t,this.gameState.player1Ship=this.ensureUserRespawn(this.gameState.player1Ship,this.engine.controller.mousePosition,this.engine.controller.buttonDown,"Player 1",1,0),this.gameState.player2Ship=this.ensureUserRespawn(this.gameState.player2Ship,{x:0,y:0},!1,"Player 2",-1,2),(!this.gameState.player3||this.gameState.player3&&this.gameState.player3.finished)&&Math.floor(Math.random()*200)===6&&this.engine.add(this.gameState.player3=new F(this.engine,4,"Player 3",{x:this.engine.width-40,y:10})),(!this.gameState.player4||this.gameState.player4&&this.gameState.player4.finished)&&Math.floor(Math.random()*200)===6&&this.engine.add(this.gameState.player4=new F(this.engine,5,"Player 4",{x:10,y:this.engine.height-50-this.barHeight}))}startSinglePlayerGame(){this.playerCount=1,this.engine.reset(),this.hideMenu()}keyboardHandler(t){t=t||window.event;const i=t.keyCode||t.which;i===49&&this.startSinglePlayerGame(),i===54&&this.startZeroPlayerGame(),i===77&&this.toggleMenu()}getDefaultGameState(){return new ht(new D(this.engine,0,1,"Player 1",{x:10,y:10},this.playerCount===0?"computer":"player"),new D(this.engine,2,-1,"Player 2",{x:this.engine.width-40,y:this.engine.height-50-this.barHeight},this.playerCount!==2?"computer":"player"))}initialize(){this.previousRightButtonDown=!1,this.initialized=!0,this.engine.canvasColor="#000",this.gameState=this.getDefaultGameState(),this.scoreBar=new R(this.engine),this.engine.add(this.scoreBar),this.engine.add(this.gameState.player1Ship),this.engine.add(this.gameState.player2Ship),this.engine.add(new p(this.engine,this.barHeight,0,"Star 1",{x:this.engine.width/2,y:this.engine.height*.25-this.barHeight},0,0)),this.engine.add(new p(this.engine,this.barHeight,2,"Star 2",{x:this.engine.width/2,y:this.engine.height*.75-this.barHeight},5,0))}getStar(t,i,n){for(const h of this.engine.entities)if(h instanceof p&&h.colorIndex===t.colorIndex&&(!i||G(h.position,h.collisionRect,n,{x:-20,y:-20,w:40,h:40})))return h;return null}spawnPlayerShip(t,i,n,h,r,l,c){let a=t;if(t.finished&&(i&&h==="player"||h==="computer")){const d=this.getStar(t,h==="player",c);d&&(a=new D(this.engine,l,r,n,c,h,d),this.engine.add(a))}return a}ensureUserRespawn(t,i,n,h,r,l){let c=t;if(t.finished){let a={x:i.x,y:i.y},d=null;(t.type==="computer"||this.engine.touchable)&&(d=this.getStar(t,!1,i),d&&(a=Z({x:d.position.x,y:d.position.y}))),(t.type==="player"||t.type==="computer"&&d)&&(c=this.spawnPlayerShip(t,n,h,t.type,r,l,a))}return c}startZeroPlayerGame(){this.playerCount=0,this.engine.reset(),this.hideMenu()}showGameOver(){this.showMenu(at)}showMenu(t){return this.menu.show(t)}toggleMenu(){return this.menu.toggle()}hideMenu(){return this.menu.hide()}}function ft(){if("ontouchstart"in window||window.TouchEvent)return!0;const e=["","-webkit-","-moz-","-o-","-ms-"].map(t=>`(${t}touch-enabled)`);return window.matchMedia(e.join(",")).matches}class gt{constructor(){o(this,"width",800);o(this,"height",600);o(this,"canvasColor","#000");o(this,"logic");o(this,"touchable",ft());o(this,"entities",[]);o(this,"canvas");o(this,"renderer");o(this,"controller");o(this,"pageColor","#000");o(this,"startTime",new Date().getTime());o(this,"keyboardController",new tt(this));o(this,"touchController",new et(this));document.onselectstart=()=>!1,document.body.oncontextmenu=()=>!1,document.body.style.background=this.pageColor,this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),this.canvas.style.position="absolute",this.canvas.style.backgroundColor="#000",this.controller=this.touchable?this.touchController:this.keyboardController,this.renderer=new q(this),this.startTime=new Date().getTime(),this.logic=new ut(this),this.add(this.logic),this.animate()}add(e){return this.entities.push(e),e.engine=this,e}update(){const e=new Date().getTime()-this.startTime;_(this.entities),this.updateEntities(e)}contains(e){return this.entities.indexOf(e)>-1}reset(e){this.entities=e?[e]:[],this.startTime=new Date().getTime(),this.add(this.logic),this.logic.initialized=!1}updateEntities(e){for(const t of this.entities)t.update(e);this.removeFinishedEntities()}removeFinishedEntities(){const e=this.entities;this.entities=[];for(const t of e)t.finished?t.finished&&t.onRemove():this.entities.push(t)}animate(){requestAnimationFrame(()=>{this.animate()}),this.update(),this.renderer.render()}}new gt;
